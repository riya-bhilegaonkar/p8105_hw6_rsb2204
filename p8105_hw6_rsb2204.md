Homework 6
================
Riya Bhilegaonkar
2022-11-27

### Problem 1

### Problem 2

Creating a `city_state` variable and a binary variable `resolved` to
indicate whether a homicide is solved. Filtering for cities that do not
include Dallas(TX), Phoenix(AZ), Kansas City(MO) and Tulsa(AL) and
filtering for the victim race of white or black. The `victim_age`
variable is changed to a numeric variable.

``` r
homicide_data = read_csv("data/homicide-data.csv") %>%
  janitor::clean_names() %>%
  mutate(city_state = str_c(city,    state, sep=", "), resolved = as.numeric(disposition == "Closed by arrest"))%>%
  filter(city_state !="Dallas, TX" | city_state !="Phoenix, AZ" | city_state!="Kansas City, MO" | city_state != "Tulsa, AL", victim_race == "White" | victim_race == "Black") %>%
  mutate(victim_age = as.numeric(victim_age), victim_race = fct_relevel(victim_race, "White"))%>%
  select(city_state, victim_sex, resolved, victim_age, victim_race)
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
View(homicide_data)
```

For the city of Baltimore, MD we use the `glm` function to fit a
logistic regression with resolved vs unsolved as the outcome and victim
age, sex and race as predictors, saving the results as an R object.

``` r
fit_logistic = homicide_data %>%
  filter(city_state == "Baltimore, MD")%>%
  glm(resolved ~ victim_age + victim_race + victim_sex, data =., family = binomial()) 
```

Displaying the estimate and the confidence interval of the adjusted odds
ratio for solving homicides comparing male victims to female victims
keeping all other variables fixed.

``` r
fit_logistic %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate)) %>% # figure out CI calculations for OR??%>%
   filter(term=="victim_sexMale")%>%
  mutate(CI.low = OR - std.error*1.96, CI.high = OR + std.error*1.96)%>%
  select(term, log_OR = estimate, OR, CI.low, CI.high) %>% 
  knitr::kable(digits = 3)
```

| term           | log_OR |    OR | CI.low | CI.high |
|:---------------|-------:|------:|-------:|--------:|
| victim_sexMale | -0.854 | 0.426 |  0.155 |   0.696 |

Running a `glm` for each city in the dataset and extracting the adjusted
odds ratio and CI for solving homicides comparing male victims to female
victims. Creating a dataframe with estimated ORs and CIs for each city:

``` r
## fix this entirely
homicide_data %>%
  nest(data=-city_state)%>%
  mutate(
    models = map(data, ~glm(resolved ~ victim_race + victim_sex + victim_age, data = homicide_data, family = binomial())),
    results = map(models, broom::tidy)) %>%
  select(-data, -models)%>%
  unnest(results)%>%
mutate(OR = exp(estimate)) %>% # figure out CI calculations for OR??
    filter(term=="victim_sexMale")%>%
  mutate(CI.low = OR - std.error*1.96, CI.high = OR + std.error*1.96)%>%
  select(city_state, term, log_OR = estimate, OR, CI.low, CI.high) %>% 
  knitr::kable(digits = 3)
```

| city_state         | term           | log_OR |    OR | CI.low | CI.high |
|:-------------------|:---------------|-------:|------:|-------:|--------:|
| Albuquerque, NM    | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Atlanta, GA        | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Baltimore, MD      | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Baton Rouge, LA    | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Birmingham, AL     | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Boston, MA         | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Buffalo, NY        | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Charlotte, NC      | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Chicago, IL        | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Cincinnati, OH     | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Columbus, OH       | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Denver, CO         | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Detroit, MI        | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Durham, NC         | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Fort Worth, TX     | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Fresno, CA         | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Houston, TX        | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Indianapolis, IN   | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Jacksonville, FL   | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Las Vegas, NV      | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Long Beach, CA     | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Los Angeles, CA    | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Louisville, KY     | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Memphis, TN        | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Miami, FL          | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Milwaukee, wI      | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Minneapolis, MN    | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Nashville, TN      | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| New Orleans, LA    | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| New York, NY       | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Oakland, CA        | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Oklahoma City, OK  | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Omaha, NE          | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Philadelphia, PA   | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Pittsburgh, PA     | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Richmond, VA       | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| San Antonio, TX    | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Sacramento, CA     | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Savannah, GA       | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| San Bernardino, CA | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| San Diego, CA      | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| San Francisco, CA  | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| St. Louis, MO      | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Stockton, CA       | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Tampa, FL          | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Tulsa, OK          | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Tulsa, AL          | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |
| Washington, DC     | victim_sexMale | -0.506 | 0.603 |  0.545 |   0.661 |

### Problem 3
